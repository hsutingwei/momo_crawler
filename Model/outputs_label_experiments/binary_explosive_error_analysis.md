# Binary Explosive Error Analysis

## 檔案說明

- **對應實驗**：`binary_explosive`（爆品 vs 非爆品 的二元分類任務）。
- **目的**：針對爆品預測任務做深入錯誤分析，了解模型表現與特徵分布差異。
- **內容包含**：
  - **Category Distribution**：TP / FP / FN / TN 四種樣本的數量與比例。
  - **Feature Comparison**：比較四種樣本在關鍵特徵上的統計值（Mean / Median / Std），特徵包含：
    - 靜態特徵：`price`, `comment_count_pre`, `score_mean` 等。
    - 時間特徵：`days_since_last_comment`, `comment_count_90d` 等。
    - 內容特徵：`sentiment_mean_recent`, `repurchase_ratio_recent` 等。
- **資料來源**：
  - 本報告由 `analyze_binary_errors.py` 自動產生。
  - **原始資料**：若需要逐樣本的詳細預測與特徵資料，請參考同資料夾下的 `binary_explosive_error_analysis.csv` 與其說明檔 `binary_explosive_error_analysis_csv_readme.md`。
- **用法**：
  - 理解模型「抓到了哪些爆品（TP）」、「漏掉了哪些（FN）」以及「誤判了什麼（FP）」。
  - 觀察特徵分布差異（如 Recency, Sentiment），作為後續特徵工程的依據。


**Total Samples:** 7197
**Best Threshold Used:** 0.6500

## 1. Category Distribution

| Category | Count | Percentage |
| --- | --- | --- |
| TP | 62 | 0.86% |
| FP | 308 | 4.28% |
| FN | 266 | 3.70% |
| TN | 6561 | 91.16% |

## 2. Feature Comparison (Mean / Median)

### price

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 1603.7097 | 1279.5000 | 1784.7195 |
| FP | 1283.4448 | 828.5000 | 1396.3085 |
| FN | 1622.5940 | 1030.0000 | 1987.4339 |
| TN | 1850.6472 | 1188.0000 | 2477.9476 |

- TN 的價格整體最高，TP / FN 稍低，FP 最低。
- 結論：價格對「是不是爆品」沒有很強的單獨區分力，比較像是在不同價位帶都有可能出現爆品。這個特徵目前偏弱訊號，不適合單獨拿來當重要判斷依據。

### comment_count_pre

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 6.1774 | 3.0000 | 9.5085 |
| FP | 5.3994 | 3.0000 | 7.0285 |
| FN | 18.0263 | 6.0000 | 42.7242 |
| TN | 15.6191 | 1.0000 | 65.8478 |

- FN 和 TN 的評論數都比 TP / FP 高很多（尤其是 FN）。
- 結論：爆品候選（y=1）不一定是評論超多的「大老商品」，很多「老牌熱門」反而被模型漏掉（FN 高），說明單看累積評論數可能會讓模型偏向老商品，而不是真的爆發。

### score_mean

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 4.8664 | 5.0000 | 0.2602 |
| FP | 4.7483 | 5.0000 | 0.7770 |
| FN | 4.6677 | 4.8824 | 0.8351 |
| TN | 2.9102 | 4.6667 | 2.3555 |

- TP / FP / FN 的平均評分都在 4.7–4.9；TN 明顯較低（約 4.1）。
- 結論：可以很明顯區分「普普通通商品」 vs「表現不錯的商品」，但在「好中挑更好的爆品」時，TP / FP / FN 差異不大，因此適合拿來過濾低品質商品，但對 TP vs FP/FN 的細緻區分有限。

### like_count_sum

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0806 | 0.0000 | 0.3289 |
| FP | 0.2175 | 0.0000 | 0.7834 |
| FN | 0.5714 | 0.0000 | 1.9553 |
| TN | 0.7523 | 0.0000 | 5.2459 |

- TN 和 FN 的 like 數反而最高，TP 最低。
- 結論：累積按讚比較像是「老商品累積出的聲量」，跟是否在 cutoff 後爆發沒有直接正相關，甚至容易在「老而不再爆」的商品上很高，可能對爆品預測是反向或噪音特徵。

### had_any_change_pre

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0000 | 0.0000 | 0.0000 |
| FP | 0.0227 | 0.0000 | 0.1493 |
| FN | 0.0150 | 0.0000 | 0.1219 |
| TN | 0.0090 | 0.0000 | 0.0944 |

- 四類別的 mean 都接近 0、差異極小。
- 結論：cutoff 之前的「有沒有變化」在目前資料裡幾乎不發生（很 sparse），對爆品區分幾乎沒有幫助。

### num_increases_pre

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0000 | 0.0000 | 0.0000 |
| FP | 0.0227 | 0.0000 | 0.1493 |
| FN | 0.0150 | 0.0000 | 0.1219 |
| TN | 0.0090 | 0.0000 | 0.0944 |

- 同上

### has_image_urls

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.2097 | 0.0000 | 0.4104 |
| FP | 0.1818 | 0.0000 | 0.3863 |
| FN | 0.4023 | 0.0000 | 0.4913 |
| TN | 0.2637 | 0.0000 | 0.4407 |

- FN 的圖片比例最高，其次 TN，TP/FP 反而較低。
- 結論：圖片比較像是「商品整體受歡迎」的指標，但對「會不會在 cutoff 後爆發」沒有清楚正相關，且 FN 偏高，代表模型對「圖片很多的老牌熱門」仍然不敏感。

### has_video_url

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.1129 | 0.0000 | 0.3191 |
| FP | 0.0584 | 0.0000 | 0.2350 |
| FN | 0.1805 | 0.0000 | 0.3853 |
| TN | 0.1259 | 0.0000 | 0.3318 |

- FN 的影片比例最高，TN 次之，TP/FP 比較低。
- 結論：和圖片類似，更像是「商家／商品重視經營」的訊號，對爆品預測目前沒有清晰的區分力，甚至偏向在被漏掉的爆品（FN）中出現較多。

### has_reply_content

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.2419 | 0.0000 | 0.4318 |
| FP | 0.2597 | 0.0000 | 0.4392 |
| FN | 0.2519 | 0.0000 | 0.4349 |
| TN | 0.1376 | 0.0000 | 0.3445 |

- TP / FP / FN 的有回覆比例都比 TN 高很多，但三者之間差異不大。
- 結論：商家有在回覆評論，可以區分「有在經營的商品」 vs 「被放生的商品」，但在有經營的那一群裡，TP/FP/FN 很像，沒辦法單獨用來區分爆品 vs 非爆品。

### comment_count_7d

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0000 | 0.0000 | 0.0000 |
| FP | 0.0000 | 0.0000 | 0.0000 |
| FN | 0.0000 | 0.0000 | 0.0000 |
| TN | 0.0000 | 0.0000 | 0.0000 |

- 幾乎全部都是 0（因為 cutoff 前大多數商品的最近評論時間都早於這個窗）。
- 結論：在目前這個 cutoff（2025-06-25）與資料分布下，7/30 天窗口太短，幾乎沒有訊號，是無效特徵。

### comment_count_30d

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0000 | 0.0000 | 0.0000 |
| FP | 0.0000 | 0.0000 | 0.0000 |
| FN | 0.0000 | 0.0000 | 0.0000 |
| TN | 0.0000 | 0.0000 | 0.0000 |

- 同上

### comment_count_90d

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 6.1774 | 3.0000 | 9.5085 |
| FP | 5.3994 | 3.0000 | 7.0285 |
| FN | 18.0263 | 6.0000 | 42.7242 |
| TN | 15.6191 | 1.0000 | 65.8478 |

- FN、TN 的 90 天評論數中位數比 TP / FP 高很多，與 comment_count_pre 同樣傾向。
- 結論：同樣偏向「老牌熱門」特性，對爆品與否不是清楚的正向指標，反而在被漏掉的爆品（FN）與大量 TN 中都偏高。

### days_since_last_comment

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 36.9911 | 39.4686 | 5.4483 |
| FP | 46.0818 | 39.4686 | 49.1765 |
| FN | 51.0207 | 40.4823 | 52.3651 |
| TN | 169.8390 | 51.1781 | 156.5967 |

- TP / FP / FN 的中位數約 39–40 天；TN 的平均高達 ~170 天，中位數也顯著較大。

- 結論：這是目前最有用的時間特徵之一：
  - 可以很清楚區分「最近還有人在討論」的商品（TP/FP/FN） vs 已經沉寂很久的商品（TN）。
  - 對於「找爆品候選」來說，至少可以先把完全冷掉的 TN 排除掉，大幅縮小搜尋範圍。

### comment_7d_ratio

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0000 | 0.0000 | 0.0000 |
| FP | 0.0000 | 0.0000 | 0.0000 |
| FN | 0.0000 | 0.0000 | 0.0000 |
| TN | 0.0000 | 0.0000 | 0.0000 |

- 幾乎全是 0。
- 結論：和 7 天評論數一樣，目前資料下是無效特徵。

### sentiment_mean_recent

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 4.8664 | 5.0000 | 0.2602 |
| FP | 4.8165 | 5.0000 | 0.3932 |
| FN | 4.7467 | 4.8824 | 0.4349 |
| TN | 4.0839 | 4.6667 | 0.9271 |

- TP 的近期評分最高（~4.87），FN 稍低，TN 明顯最低。

- 結論：
  - 可以區分「近期風評好」 vs 「近期風評普通／差」，對於排除 TN 很有幫助。
  - TP vs FP vs FN 差異雖然存在但不大，表示：
    近期很高的評分」是爆品出現的必要條件之一，但不是充分條件，需要搭配其他特徵（時間、關鍵字）一起看。

### neg_ratio_recent

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0016 | 0.0000 | 0.0127 |
| FP | 0.0023 | 0.0000 | 0.0245 |
| FN | 0.0049 | 0.0000 | 0.0254 |
| TN | 0.0046 | 0.0000 | 0.0353 |

- 四類別的負評比例都接近 0，差異極小。
- 結論：目前資料下，負評非常少，這個特徵 almost flat，對區分 TP/FP/FN/TN 幫助不大。

### promo_ratio_recent

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0080 | 0.0000 | 0.0257 |
| FP | 0.0162 | 0.0000 | 0.0670 |
| FN | 0.0362 | 0.0000 | 0.0826 |
| TN | 0.0208 | 0.0000 | 0.0621 |

- FN 的促銷關鍵字比例最高，其次 TN，FP 再來，TP 反而最低。
- 結論：
  - 促銷用語的出現，不一定代表「真的會爆」，在被漏掉的爆品（FN）與部分 TN 裡反而偏高。
  - 模型目前對「有促銷字眼」的情境，容易搞成「噪音」或「老商品促銷」，還沒有學會把它當成爆發訊號，需要更細的處理（例如搭配時間、類別、價位分段）。

### repurchase_ratio_recent

| Category | Mean | Median | Std |
| --- | --- | --- | --- |
| TP | 0.0770 | 0.0000 | 0.1284 |
| FP | 0.1086 | 0.0000 | 0.1529 |
| FN | 0.1736 | 0.1613 | 0.1652 |
| TN | 0.1122 | 0.0000 | 0.1599 |

- FN 的回購比例最高（≈0.17），TN 次之，FP ≈0.11，TP 反而最低（≈0.08）。
- 結論：
  - 「有很多人說要回購 / 囤貨」確實是在某些爆品身上很常見，但模型現在常常把這些商品漏判成 0（FN），說明：
    - 這類商品可能是「穩定熱賣的老牌爆品」，
    - 我的 label 定義看的是「cutoff 之後的爆發」，不是「長期穩定暢銷」。
  - 這個特徵提示：「回購型爆品」可能需要另外建模，或至少在分析上分成不同子族群來看。

## 3. Key Observations

### TP vs FN (Missed Opportunities)
- **Price**: TP median (1279.5) vs FN median (1030.0).
- **Comments**: TP median (3.0) vs FN median (6.0).

### FP vs TP (False Alarms)
- **Price**: FP median (828.5) vs TP median (1279.5).
- **Comments**: FP median (3.0) vs TP median (3.0).

## 4. 結論

### 有效特徵：
days_since_last_comment、sentiment_mean_recent（排 TN）、再搭配一些互動指標。

### 弱訊號或幾乎無效：
7/30 天評論、負評比例、累積 like。

### 有趣但需要更細建模的特徵：
promo_ratio_recent、repurchase_ratio_recent —— 特別提醒「回購型爆品」這一塊。


## Temporal Trend Features (90-day window)

在此次實驗中，我們加入了 90 天內的三段式評論數統計與加速比率特徵，以捕捉爆發前的趨勢：

- **comment_3rd_30d**: 最近 30 天 (0-30 days before cutoff)
- **comment_2nd_30d**: 中間 30 天 (31-60 days before cutoff)
- **comment_1st_30d**: 最早 30 天 (61-90 days before cutoff)
- **ratio_recent30_to_prev60**: 加速比率 = `comment_3rd_30d / (comment_1st_30d + comment_2nd_30d + 1e-6)`

### 特徵平均值比較 (Mean Values by Group)

| group   |   comment_1st_30d |   comment_2nd_30d |   comment_3rd_30d |   ratio_recent30_to_prev60 |
|:--------|------------------:|------------------:|------------------:|---------------------------:|
| TP      |                 0 |           6.17742 |                 0 |                          0 |
| FN      |                 0 |          18.0263  |                 0 |                          0 |
| FP      |                 0 |           5.39935 |                 0 |                          0 |
| TN      |                 0 |          15.6191  |                 0 |                          0 |

### 初步觀察結論

- **無明顯加速特徵**：TP 的加速比率 (0.00) 並未高於 TN (0.00)。




## Temporal Trend Features (90-day window)

在此次實驗中，我們加入了 90 天內的三段式評論數統計與加速比率特徵，以捕捉爆發前的趨勢：

- **comment_3rd_30d**: 最近 30 天 (0-30 days before cutoff)
- **comment_2nd_30d**: 中間 30 天 (31-60 days before cutoff)
- **comment_1st_30d**: 最早 30 天 (61-90 days before cutoff)
- **ratio_recent30_to_prev60**: 加速比率 = `comment_3rd_30d / (comment_1st_30d + comment_2nd_30d + 1e-6)`

### 特徵平均值比較 (Mean Values by Group)

| group   |   comment_1st_30d |   comment_2nd_30d |   comment_3rd_30d |   ratio_recent30_to_prev60 |
|:--------|------------------:|------------------:|------------------:|---------------------------:|
| TP      |           1.30818 |           1.85535 |           2.42767 |                   308177   |
| FN      |           2.06509 |           2.49112 |           2.6213  |                   278107   |
| FP      |           1.22985 |           1.56947 |           2.02401 |                   351630   |
| TN      |           1.0167  |           1.12584 |           1.14811 |                    65542.6 |

### 初步觀察結論

- **正向訊號明顯**：TP 的加速比率 (308176.89) 顯著高於 TN (65542.62)，顯示爆品在 cutoff 前確實有加速跡象。
- **漏抓原因**：FN 的加速比率 (278107.05) 低於 TP，可能因為這些爆品是「突然爆發」或「穩定成長型」，在 cutoff 前尚未展現明顯加速。


## Arousal & Novelty Analysis (Emotional Intensity)

為了區分「穩定熱銷 (Sustained Hits)」與「爆發新品 (Viral Hits)」，我們引入了情緒強度特徵：

- **arousal_ratio**: 驚嘆、誇張、強烈情緒關鍵字比例 (e.g. 驚豔, 太神, 扯)。
- **novelty_ratio**: 初次體驗、觀望很久關鍵字比例 (e.g. 第一次買, 終於下手)。
- **intensity_score**: 複合指標 = `(arousal + novelty) / (repurchase + 0.1)`。設計用來獎勵高情緒/新奇，懲罰無聊的回購。

### 特徵平均值比較 (Mean Values by Group)

| group   |   arousal_ratio |   novelty_ratio |   intensity_score |   repurchase_ratio_recent |
|:--------|----------------:|----------------:|------------------:|--------------------------:|
| TP      |     0.000626959 |      0.00505704 |         0.0289062 |                 0.146856  |
| FN      |     0.00485149  |      0.0129273  |         0.100792  |                 0.184736  |
| FP      |     0.00279757  |      0.011589   |         0.0994792 |                 0.173341  |
| TN      |     0.0023456   |      0.0035803  |         0.0353197 |                 0.0731635 |

### 初步觀察結論

- **強度區分不明顯**：TP (0.0289) 與 TN (0.0353) 差異不大。
- **誤判來源**：FP 的 Intensity Score (0.0995) 甚至高於 TP，顯示有些非爆品雖然情緒激動 (Arousal 高)，但可能缺乏其他支撐 (如銷量轉化)，導致模型誤判。


## Interaction Features Analysis (Cross Features)

為了進一步區分雜訊與真實爆發，我們引入了交互特徵：

- **validated_velocity**: `Acceleration * log1p(Volume)`。確認高成長是否由足夠的評論量支撐。
- **price_weighted_arousal**: `Arousal * log1p(Price)`。區分「廉價炒作 (FP)」與「高價驚豔 (TP)」。
- **novelty_momentum**: `Acceleration * (1 - Repurchase)`。確認成長動力來自「新客」而非「回購」。
- **is_mature_product**: 標記是否為成熟商品 (高累積評論或高回購)。

### 特徵平均值比較 (Mean Values by Group)

| group   |   arousal_ratio |   novelty_ratio |   intensity_score |   repurchase_ratio_recent |   validated_velocity |   price_weighted_arousal |   novelty_momentum |   is_mature_product |
|:--------|----------------:|----------------:|------------------:|--------------------------:|---------------------:|-------------------------:|-------------------:|--------------------:|
| TP      |     0.000886539 |      0.00828306 |         0.0367338 |                 0.153247  |             409991   |               0.00576174 |           297805   |            0.341317 |
| FN      |     0.0051595   |      0.0106565  |         0.102496  |                 0.183283  |             500213   |               0.0443848  |           192029   |            0.447205 |
| FP      |     0.00239448  |      0.0123713  |         0.0881227 |                 0.183167  |             351001   |               0.0163789  |           282257   |            0.414966 |
| TN      |     0.00237499  |      0.00335916 |         0.035198  |                 0.0703935 |              65138.1 |               0.0160393  |            58700.2 |            0.188664 |

### 深入觀察結論

- **速度驗證有效**：TP 的 Validated Velocity (409991.1726) 高於 FP (351000.7476)，顯示真爆品通常伴隨更紮實的評論量成長。
- **價格過濾不明顯**：TP (0.0058) 與 FP (0.0164) 差異不大，可能因為部分爆品本身也是低價品。
- **新客動力區分**：TP 的 Novelty Momentum (297805.0541) 顯著高於 FN (192029.3889)，證實了爆品成長主要來自新客，而 FN 多為回購驅動。
